{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "5c868717_8aab9f3e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 9,
      "author": {
        "id": 21651
      },
      "writtenOn": "2022-10-17T11:15:22Z",
      "side": 1,
      "message": "Could you link some source for this?",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 9,
        "endChar": 41
      },
      "revId": "d86d8cbd120fe0fafc070997c06d3d6dc2a35c2a",
      "serverId": "1ec6b3db-b2c1-4fa4-84a2-4c7efe89ba71"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7a4debc7_33d8f637",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 21651
      },
      "writtenOn": "2022-10-15T06:08:47Z",
      "side": 1,
      "message": "Maybe this works: https://git.codelinaro.org/clo/la/device/qcom/sepolicy/-/commit/b69efc22159aba49a9f5323f06c9cb8a3181ec43 ?",
      "revId": "d86d8cbd120fe0fafc070997c06d3d6dc2a35c2a",
      "serverId": "1ec6b3db-b2c1-4fa4-84a2-4c7efe89ba71"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7402a068_f0ab9e1b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 5911
      },
      "writtenOn": "2022-10-15T09:10:24Z",
      "side": 1,
      "message": "no, we need the other policies, especially for persist_alarm_file, so this is the minimal modification to make it work properly with updated blobs. for the same reason, reverting the \"add poweroffalarm\" commit in spolicy-legacy-um wont work",
      "revId": "d86d8cbd120fe0fafc070997c06d3d6dc2a35c2a",
      "serverId": "1ec6b3db-b2c1-4fa4-84a2-4c7efe89ba71"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b0aad5cc_59225e7a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 13648
      },
      "writtenOn": "2022-10-15T19:58:19Z",
      "side": 1,
      "message": "What do you call \"updated blobs\"? I have power-off alarms working on mi8996 for example and no sepolicy changes were required.",
      "parentUuid": "7402a068_f0ab9e1b",
      "revId": "d86d8cbd120fe0fafc070997c06d3d6dc2a35c2a",
      "serverId": "1ec6b3db-b2c1-4fa4-84a2-4c7efe89ba71"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e9b579b2_916f73d6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 5911
      },
      "writtenOn": "2022-10-17T09:25:42Z",
      "side": 1,
      "message": "as mentioned in the commit msg: an apk without sharedUserId\u003dsystem in the manifest.",
      "revId": "d86d8cbd120fe0fafc070997c06d3d6dc2a35c2a",
      "serverId": "1ec6b3db-b2c1-4fa4-84a2-4c7efe89ba71"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "06fab485_8ba19b11",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 5911
      },
      "writtenOn": "2022-10-17T09:33:58Z",
      "side": 1,
      "message": "and you are saying poweroffalarm works for you including writing to its local data dir in user_de/0/com.qti.qualcomm.poweroffalarm? i would like to see logs of that",
      "revId": "d86d8cbd120fe0fafc070997c06d3d6dc2a35c2a",
      "serverId": "1ec6b3db-b2c1-4fa4-84a2-4c7efe89ba71"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "31141c2f_504e6460",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 13648
      },
      "writtenOn": "2022-10-17T09:51:50Z",
      "side": 1,
      "message": "I didn\u0027t even care to look at logs since poweroffalarm just does what\u0027s expected.",
      "parentUuid": "06fab485_8ba19b11",
      "revId": "d86d8cbd120fe0fafc070997c06d3d6dc2a35c2a",
      "serverId": "1ec6b3db-b2c1-4fa4-84a2-4c7efe89ba71"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "30cb437d_9d14e9a4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 5911
      },
      "writtenOn": "2022-10-17T13:58:51Z",
      "side": 1,
      "message": "@bruno: i did care ;) also it doesn\u0027t do what\u0027s expected if you set the alarm, reboot, and then power it off, as the database can\u0027t be written.\n\n@timi: https://developer.android.com/guide/topics/manifest/manifest-element#uid\ndeprecated as of api 29, ignored for new installs as of 32.\n\n@both: logcat is pretty verbose about it, actually, first firing some warnings, then selinux denials which cause the apk to crash (at least all of the ones i tried: op8998, xiaomi8998, pro1) when setting an alarm because the db can\u0027t be written to /data/user_de/0/com.qti.qualcomm.poweroffalarm. though the process context is correct and the context of the on-disk files too.\n\nthat\u0027s why all apks i found \u003e api30 removed this flag altogether, thus running in in a generated app user.\n\nalso, sadly, just replacing the apk didn\u0027t work for us on op8998, because while the apk itself would then work, the poweroffalarm hal crapped out due to unexpected callbacks. hence the reason for nicking it altogether from sdm845, which works flawlessly",
      "revId": "d86d8cbd120fe0fafc070997c06d3d6dc2a35c2a",
      "serverId": "1ec6b3db-b2c1-4fa4-84a2-4c7efe89ba71"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f4637145_4682b820",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 5911
      },
      "writtenOn": "2022-10-17T14:18:30Z",
      "side": 1,
      "message": "also, tbh, not even sure if this problem didn\u0027t occur on 19 already, can\u0027t go back to check. but this seems to be the same issue, except the user didn\u0027t capture the selinux denial: https://gitlab.com/LineageOS/issues/android/-/issues/4770",
      "revId": "d86d8cbd120fe0fafc070997c06d3d6dc2a35c2a",
      "serverId": "1ec6b3db-b2c1-4fa4-84a2-4c7efe89ba71"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "68b0a017_a84a9f61",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 15609
      },
      "writtenOn": "2022-10-17T14:32:16Z",
      "side": 1,
      "message": "https://github.com/roberto-sartori-gl/device_qcom_sepolicy/commit/2ffa8503342850a5c586420acb6f0e72dbc0664d\n\nPowerOffAlarm works fine with this on A13 on msm8998. I understand this may be an hack, just saying that it is a selinux issue (present also on a12).\nThe app runs as system UID on A13: the sharedUserId is still considered on A13 (for example, the Settings app is still using it). \n\nOn the device, the app is running as system:\n\n$ adb shell ps -A | grep -i power\n...\nsystem        3147   878 14370896 57352 0                   0 S com.qualcomm.qti.poweroffalarm",
      "revId": "d86d8cbd120fe0fafc070997c06d3d6dc2a35c2a",
      "serverId": "1ec6b3db-b2c1-4fa4-84a2-4c7efe89ba71"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "95719c76_e3f0f7a8",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 5911
      },
      "writtenOn": "2022-10-17T14:34:56Z",
      "side": 1,
      "message": "yeah, that\u0027s what i stated above: the process is still in the right context, so are the files on disk. still, it\u0027ll crash without modification, and i didn\u0027t want to go the mlstrustedsubject route, although your solution works, yes.",
      "revId": "d86d8cbd120fe0fafc070997c06d3d6dc2a35c2a",
      "serverId": "1ec6b3db-b2c1-4fa4-84a2-4c7efe89ba71"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "167ddcd6_b659de00",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 15609
      },
      "writtenOn": "2022-10-17T16:16:46Z",
      "side": 1,
      "message": "Yep, but the commit message is a bit confusing, as \u0027sharedUserId\u0027 is not actually ignored and this change in the SEPolicy is needed because the apk was changed to solve a different issue (also not realted to the \u0027sharedUserId\u0027).",
      "parentUuid": "95719c76_e3f0f7a8",
      "revId": "d86d8cbd120fe0fafc070997c06d3d6dc2a35c2a",
      "serverId": "1ec6b3db-b2c1-4fa4-84a2-4c7efe89ba71"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "34d0553d_fa4dfbef",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 13648
      },
      "writtenOn": "2022-10-18T09:53:02Z",
      "side": 1,
      "message": "I take this back, it seems that I was still running an A12 build. With A13 it stopped working indeed. I will try with this change.",
      "parentUuid": "31141c2f_504e6460",
      "revId": "d86d8cbd120fe0fafc070997c06d3d6dc2a35c2a",
      "serverId": "1ec6b3db-b2c1-4fa4-84a2-4c7efe89ba71"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "05675e95_48b2f2bf",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 5911
      },
      "writtenOn": "2022-10-18T10:40:55Z",
      "side": 1,
      "message": "actually no, the apk changed exactly because of this ;) when modifying the old one to remove the sharedUserId the data directory access works, but then talking to the hal kinda breaks. not worth the effort debugging this any further for such a low-key \"feature\" imo",
      "parentUuid": "167ddcd6_b659de00",
      "revId": "d86d8cbd120fe0fafc070997c06d3d6dc2a35c2a",
      "serverId": "1ec6b3db-b2c1-4fa4-84a2-4c7efe89ba71"
    }
  ]
}